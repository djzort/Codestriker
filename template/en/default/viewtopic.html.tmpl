[%# Screen for displaying the heading information of a topic.  The
    actual view topic data is still generated directly from the perl
    script, as it is complex HTML that doesn't need to be
    customised. #%]

[% PROCESS header.html.tmpl version = version %]

<script language="JavaScript">
<!-- script to hit user with are you sure if they are deleting a topic.

/* This function will hit the user with a "are you sure" message box if they
   ask to delete the topic. Otherwise, just let them change the state. It
   is called when the submit button is pressed. 
*/
function DeleteTopicConfirm()
{
    var stateIndex = document.form.topic_state.options.selectedIndex;
    var stateSelection = document.form.topic_state.options[stateIndex].value;
    
    // Confirm with the user if they are deleting.
    if (stateSelection == 'Delete')
    {
    	return confirm('This topic and all of its comments will be permanently ' + 
                       'removed. Are you sure you want to delete this topic?');
    }
    
    return 1;
}

-->
</script>

[%# Show the top-level links for "Create new topic", "List open topics",
    "search", and "View all comments" #%]
<p>
    <a href="[% create_topic_url %]">Create new topic</a>
[% IF searchlist_enabled != 0 %]
    | <a href="[% list_url %]">List open topics</a>
[% IF projects_enabled != 0 %]
    | <a href="[% list_url_in_project %]">List open topics in project</a>
[% END %]
    | <a href="[% search_url %]">Search</a>
[% END %]
[% IF projects_enabled != 0 %]
    | <a href="[% list_projects_url %]">List projects</a>
[% END %]
    | <a href="[% view_comments_url %]">View all comments</a>
    | <a href="[% doc_url %]/x380.html#VIEW-TOPIC">Help</a>
<HR>

<p>
[%# Display any "feedback" to the user if necessary. #%]
[% IF feedback != '' %]
    <font color="red">[% feedback %]</font>
    <p>
[% END %]

[%# Create a table illustrating the title, author, creation date, bug
    ids, reviewers, number of lines and the current state. #%]

<table cellpadding="2" cellspacing="2" border="0">

<tr class="tth">
 <td><b>Title:</b></td>
 <td><b>[% escaped_title %]</b></td>
</th>

[% SET type = 0 %]

<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>Author:</td>
 <td>[% document_author %]</td>
</tr>

<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>Created:</td>
 <td>[% document_creation_time %]</td>
</tr>

[% IF bug_string != '' %]
<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>Bug IDs:</td>
 <td>[% bug_string %]</td>
</tr>
[% END %]

<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>Reviewers:</td>
 <td>[% document_reviewers %]</td>
</tr>

<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>Number of lines:</td>
 <td>[% number_of_lines %]
  [%# Give them a nudge, that the topic is too large. #%] 
  [% IF number_of_lines > suggested_topic_size_lines && suggested_topic_size_lines > 0 %]
    <FONT color=red>-- over suggested topic size limit of [% suggested_topic_size_lines %] lines.</FONT>
  [% END %]
  
 </td>
</tr>

[% IF repository != '' %]
<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>Repository:</td>
 <td>[% repository %]</td>
</tr>
[% END %]

[% IF projects_enabled != 0 %]
<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>Project:</td>
 <td>[% project_name %]</td>
</tr>
[% END %]

<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td valign="top">Description:</td>
 <td><pre>[% description %]</pre></td>
</tr>

[%# Display the form for changing the topic state #%]
<form method="post" enctype="application/x-www-form-urlencoded" name="form">
<tr class="tt[% type mod 2 %]">
 [% type = type + 1 %]
 <td>State:
<FONT SIZE="-2"><A HREF="javascript:alert('
When a topic is created, it is initialised in state \'open\'.\n
Once a topic has been reviewed, and the code has been committed,\n
the state should be updated to \'committed\'.  If the code\n
in this review is not be committed, perhaps because a\n
new review will superceed this one, or because it was rejected,\n
the state should be changed to \'closed\'.\n
\n
If a topic is linked to Bugzilla bugs, each time the topic\n
state is changed, an appropriate comment will be appended to\n
all associated bugs, as a form of tracking.\n
\n
The topic states are also useful as a form of filtering, when\n
retrieving lists of topics from the search page.
')">(What's this?)</A></FONT>
</td>
 <td>
   <input type="hidden" name="action" value="change_topic_state">
   <input type="hidden" name="topic" value="[% topicid %]">
   <input type="hidden" name="mode" value="[% mode %]">
   <input type="hidden" name="version" value="[% topic_version %]">

   [%# Now display the option button for changing the topic state #%]
   <select name="topic_state">
   [% FOREACH state = states %]
       [% IF state == default_state %]
           <option selected value="[% state %]">[% state %]
       [% ELSE %]           
           <option value="[% state %]">[% state %]
       [% END %]
   [% END %]
   [%# Render a "delete" button, for deleting topics, if enabled #%]
   [% IF delete_enabled != 0 %]
   	<option value="Delete">Delete Topic ... 
   [% END %]
   </select>

   [%# Render the submit button #%]
   <input type="submit" name="button" value="Update" onClick="return DeleteTopicConfirm();"> 
 </td>
</tr>

<tr class="tth"><td colspan="2">&nbsp</td></tr>

</form>
</table>   

[%# Now display the number of comments made, with a link to the
    comment section. #%]
<p>
[% IF number_comments == 1 %]
    Only one <a href="[% comment_url %]">comment</a> submitted.
[% ELSIF number_comments > 1 %]
    [% number_comments %] <a href="[% comment_url %]">comments</a> submitted.
[% END %]

<br>

[%# Display the "Download topic text" link #%]
<a href="[% download_url %]">Download</a> topic text.

<p>
<hr>
<p>

[%# The perl script takes control from here, rendering the topic data #%]



